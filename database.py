aW1wb3J0IG9zCmltcG9ydCBhaW9zcWxpdGUKaW1wb3J0IGFzeW5jcGcKaW1wb3J0IGxvZ2dpbmcKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCiMg0J3QsNGB0YLRgNC+0LnQutC4CkRCX05BTUUgPSAiYm90X2RhdGFiYXNlLmRiIgpEQVRBQkFTRV9VUkwgPSBvcy5nZXRlbnYoIkRBVEFCQVNFX1VSTCIpICMgUmFpbHdheSDQv9GA0LXQtNC+0YHRgtCw0LLQu9GP0LXRgiDRjdGC0YMg0L/QtdGA0LXQvNC10L3QvdGD0Y4g0LTQu9GPIFBvc3RncmVzCgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCmNsYXNzIERhdGFiYXNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYudHlwZSA9ICJwb3N0Z3JlcyIgaWYgREFUQUJBU0VfVVJMIGVsc2UgInNxbGl0ZSIKICAgICAgICBzZWxmLnBvb2wgPSBOb25lCgogICAgYXN5bmMgZGVmIGNvbm5lY3Qoc2VsZik6CiAgICAgICAgaWYgc2VsZi50eXBlID09ICJwb3N0Z3JlcyI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYucG9vbCA9IGF3YWl0IGFzeW5jcGcuY3JlYXRlX3Bvb2woREFUQUJBU0VfVVJMKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNvbm5lY3RlZCB0byBQb3N0Z3JlU1FMIikKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuaW5pdF9wb3N0Z3JlcygpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlBvc3RncmVzIGNvbm5lY3Rpb24gZmFpbGVkOiB7ZX0uIEZhbGxpbmcgYmFjayB0byBTUUxpdGUuIikKICAgICAgICAgICAgICAgIHNlbGYudHlwZSA9ICJzcWxpdGUiCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi50eXBlID09ICJzcWxpdGUiOgogICAgICAgICAgICBsb2dnZXIuaW5mbygiVXNpbmcgU1FMaXRlIikKICAgICAgICAgICAgYXdhaXQgc2VsZi5pbml0X3NxbGl0ZSgpCgogICAgYXN5bmMgZGVmIGluaXRfcG9zdGdyZXMoc2VsZik6CiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLnBvb2wuYWNxdWlyZSgpIGFzIGNvbm46CiAgICAgICAgICAgIGF3YWl0IGNvbm4uZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHN1c2VycyAoCiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCBCSUdJTlQgUFJJTUFSWSBLRVksCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgVEVYVCwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9tb2RlbCBURVhUIERFRkFVTFQgJ2dlbWluaS0yLjUtZmxhc2gnLAogICAgICAgICAgICAgICAgICAgIHN5c3RlbV9pbnN0cnVjdGlvbiBURVhUIERFRkFVTFQgJ9Ci0YsgML/QvtC70LXQt9C90YvQuSDQuCDRg9C80L3Ri9C5INCw0YHRgdC40YHRgtC10L3Rgi4nLAogICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlIFJFQUwgREVGQVVMVCAwLjcsCiAgICAgICAgICAgICAgICAgICAgbWF4X3Rva2VucyBJTlRFR0VSIERFRUFVTFQGNA5NiwKICAgICAgICAgICAgICAgICAgICB1c2VfdG9vbHMgQk9PTEVBTiBERUZBVUxUIEZBTFNFLAogICAgICAgICAgICAgICAgICAgIHN0cmVhbV9yZXNwb25zZSBCT09MRUFOIERFRkFVTFQgVFJVRQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAiIiIpCiAgICAgICAgICAgIGF3YWl0IGNvbm4uZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGB5ZXNzYWdlX2hpc3RvcnkgKAogICAgICAgICAgICAgICAgICAgIGlkIFNFUklBTCBQUklNQVJZIEtFWSwKICAgICAgICAgICAgICAgICAgICB1c2VyX2lkIEJJR0lOVCBSRUZFUkVOQ0VTIGB1c2VycyD1c2VyX2lkKSwKICAgICAgICAgICAgICAgICAgICByb2xlIFRFWFQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudCBURVhULAogICAgICAgICAgICAgICAgICAgIGhhc19tZWRpYSBCT09MRUFOIERFRkFVTFQgRkFMU0UsCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wIFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICIiIikKCiAgICBhc3luYyBkZWYgaW5pdF9zcWxpdGUoc2VsZik6CiAgICAgICAgYXN5bmMgd2l0aCBhaW9zcWxpdGUuY29ubmVjdChEQl9OQU1FKSBhcyBkYjoKICAgICAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGB1c2VycyAoCiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCBJTlRFR0VSIFBSSU1BUlkgS0VZLAogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lIFRFWFQsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWwgVEVYVCBERUZBVUxUICdnZW1pbmktMi41LWZsYXNoJywKICAgICAgICAgICAgICAgICAgICBzeXN0ZW1faW5zdHJ1Y3Rpb24gVEVYVCBERUZBVUxUICfQotGLINC/0L7Qu9C10LfQvdGL0Lkg0Lgg0YPQvNC90YvQuSDQsNGB0YHQuNGB0YLQtdC90YIuJywKICAgICAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZSBSRUFMIERFRkFVTFQgMC43LAogICAgICAgICAgICAgICAgICAgIG1heF90b2tlbnMgSU5URUdFUiBERUZBVUxUIDQwOTYsCiAgICAgICAgICAgICAgICAgICAgdXNlX3Rvb2xzIEJPT0xFQU4gREVGQVVMVCAwLAogICAgICAgICAgICAgICAgICAgIHN0cmVhbV9yZXNwb25zZSBCT09MRUFOIERFRkFVTFQgMQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAiIiIpCiAgICAgICAgICAgICMgTWlncmF0aW9ucyBmb3Igc3FsaXRlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoIkFMVEVSIFRBQkxFIHVzZXJzIEFERCBDT0xVTU4gc3RyZWFtX3Jlc3BvbnNlIEJPT0xFQU4gREVGQVVMVCAxIikKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICBhd2FpdCBkYi5leGVjdXRlKCIiIgogICAgICAgICAgICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgbWVzc2FnZV9oaXN0b3J5ICgKICAgICAgICAgICAgICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsCiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCBJTlRFR0VSLAogICAgICAgICAgICAgICAgICAgIHJvbGUgVEVYVCwKICAgICAgICAgICAgICAgICAgICBjb250ZW50IFRFWFQsCiAgICAgICAgICAgICAgICAgICAgaGFzX21lZGlhIEJPT0xFQU4gREVGQVVMVCAwLAogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCBEQVRFVElNRSBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QLAogICAgICAgICAgICAgICAgICAgIEZPUkVJR04gS0VZICh1c2VyX2lkKSBSRUZFUkVOQ0VTIGB1c2VycyAodXNlcl9pZCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgIiIiKQogICAgICAgICAgICBhd2FpdCBkYi5jb21taXQoKQoKICAgIGFzeW5jIGRlZiBnZXRfdXNlcl9zZXR0aW5ncyhzZWxmLCB1c2VyX2lkOiBpbnQpOgogICAgICAgIGRlZmF1bHRzID0gewogICAgICAgICAgICAidXNlcl9pZCI6IHVzZXJfaWQsCiAgICAgICAgICAgICJzZWxlY3RlZF9tb2RlbCI6ICJnZW1pbmktMi41LWZsYXNoIiwKICAgICAgICAgICAgInN5c3RlbV9pbnN0cnVjdGlvbiI6ICLQotGLINC/0L7Qu9C10LfQvdGL0Lkg0Lgg0YPQvNC90YvQuSDQsNGB0YHQuNGB0YLQtdC90YIuIiwKICAgICAgICAgICAgInRlbXBlcmF0dXJlIjogMC43LAogICAgICAgICAgICAibWF4X3Rva2VucyI6IDQwOTYsCiAgICAgICAgICAgICJ1c2VfdG9vbHMiOiBGYWxzZSwKICAgICAgICAgICAgInN0cmVhbV9yZXNwb25zZSI6IFRydWUKICAgICAgICB9CgogICAgICAgIGlmIHNlbGYudHlwZSA9PSAicG9zdGdyZXMiOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5wb29sOiBhd2FpdCBzZWxmLmNvbm5lY3QoKQogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYucG9vbC5hY3F1aXJlKCkgYXMgY29ubjoKICAgICAgICAgICAgICAgIHJvdyA9IGF3YWl0IGNvbm4uZmV0Y2hyb3coIlNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgdXNlcl9pZCA9ICQxIiwgdXNlcl9pZCkKICAgICAgICAgICAgICAgIGlmIHJvdzogcmV0dXJuIGRpY3Qocm93KQogICAgICAgICAgICAgICAgYXdhaXQgY29ubi5leGVjdXRlKCJJTlNFUlQgSU5UTyB1c2VycyAodXNlcl9pZCkgVkFMVUVTICgkMSkgT04gQ09ORkxJQ1QgRE8gTk9USElORyIsIHVzZXJfaWQpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdHMKICAgICAgICBlbHNlOgogICAgICAgICAgICBhc3luYyB3aXRoIGFpb3NxbGl0ZS5jb25uZWN0KERCX05BTUUpIGFzIGRiOgogICAgICAgICAgICAgICAgZGIucm93X2ZhY3RvcnkgPSBhaW9zcWxpdGUuUm93CiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIGRiLmV4ZWN1dGUoIlNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgdXNlcl9pZCA9ID8iLCAodXNlcl9pZCwpKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICAgICAgcm93ID0gYXdhaXQgY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgICAgICAgICBpZiByb3c6IHJldHVybiBkaWN0KHJvdykKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkYi5leGVjdXRlKCJJTlNFUlQgSU5UTyB1c2VycyAodXNlcl9pZCkgVkFMVUVTICg/KSIsICh1c2VyX2lkLCkpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGIuY29tbWl0KCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdHMKCiAgICBhc3luYyBkZWYgdXBkYXRlX3VzZXJfc2V0dGluZyhzZWxmLCB1c2VyX2lkOiBpbnQsIHNldHRpbmc6IHN0ciwgdmFsdWUpOgogICAgICAgICMgV2hpdGVsaXN0IGFsbG93ZWQgc2V0dGluZ3MgdG8gcHJldmVudCBTUUwgaW5qZWN0aW9uCiAgICAgICAgYWxsb3dlZF9zZXR0aW5ncyA9IHsKICAgICAgICAgICAgJ3VzZXJuYW1lJywgJ3NlbGVjdGVkX21vZGVsJywgJ3N5c3RlbV9pbnN0cnVjdGlvbicsCiAgICAgICAgICAgICd0ZW1wZXJhdHVyZScsICdtYXhfdG9rZW5zJywgJ3VzZV90b29scycsICdzdHJlYW1fcmVzcG9uc2UnCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIHNldHRpbmcgbm90IGluIGFsbG93ZWRfc2V0dGluZ3M6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJJbnZhbGlkIHNldHRpbmc6IHtzZXR0aW5nfSIpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi50eXBlID09ICJwb3N0Z3JlcyI6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnBvb2w6IGF3YWl0IHNlbGYuY29ubmVjdCgpCiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5wb29sLmFjcXVpcmUoKSBhcyBjb25uOgogICAgICAgICAgICAgICAgIyBQb3N0Z3JlcyBib29sZWFuIGhhbmRsaW5nCiAgICAgICAgICAgICAgICBpZiBzZXR0aW5nIGluIFsndXNlX3Rvb2xzJywgJ3N0cmVhbV9yZXNwb25zZSddOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYm9vbCh2YWx1ZSkKICAgICAgICAgICAgICAgICMgU2FmZTogc2V0dGluZyBpcyB2YWxpZGF0ZWQgZnJvbSB3aGl0ZWxpc3QKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZiJVUERBVEUgdXNlcnMgU0VUIHN7c2V0dGluZ30gPSAkMSBXSEVSRSB1c2VyX2lkID0gJDIiCiAgICAgICAgICAgICAgICBhd2FpdCBjb25uLmV4ZWN1dGUocXVlcnksIHZhbHVlLCB1c2VyX2lkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QoREJfTkFNRSkgYXMgZGI6CiAgICAgICAgICAgICAgICAjIFNhZmU6IHNldHRpbmcgaXMgdmFsaWRhdGVkIGZyb20gd2hpdGVsaXN0CiAgICAgICAgICAgICAgICBxdWVyeSA9IGYiVVBEQVRFIHVzZXJzIFNFVCB7c2V0dGluZ30gPSA/IFdIRVJFIHVzZXJfaWQgPSA/IgogICAgICAgICAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShxdWVyeSwgKHZhbHVlLCB1c2VyX2lkKSkKICAgICAgICAgICAgICAgIGF3YWl0IGRiLmNvbW1pdCgpCgogICAgYXN5bmMgZGVmIHNhdmVfbWVzc2FnZShzZWxmLCB1c2VyX2lkOiBpbnQsIHJvbGU6IHN0ciwgY29udGVudDogc3RyLCBoYXNfbWVkaWE6IGJvb2wgPSBGYWxzZSk6CiAgICAgICAgaWYgc2VsZi50eXBlID09ICJwb3N0Z3JlcyI6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnBvb2w6IGF3YWl0IHNlbGYuY29ubmVjdCgpCiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5wb29sLmFjcXVpcmUoKSBhcyBjb25uOgogICAgICAgICAgICAgICAgYXdhaXQgY29ubi5leGVjdXRlKAogICAgICAgICAgICAgICAgICAgICJJTlNFUlQgSU5UTyBtZXNzYWdlX2hpc3RvcnkgKHVzZXJfaWQsIHJvbGUsIGNvbnRlbnQsIGhhc19tZWRpYSkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCkiLAogICAgICAgICAgICAgICAgICAgIHVzZXJfaWQsIHJvbGUsIGNvbnRlbnQsIGhhc19tZWRpYQogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QoREJfTkFNRSkgYXMgZGI6CiAgICAgICAgICAgICAgICBhd2FpdCBkYi5leGVjdXRlKAogICAgICAgICAgICAgICAgICAgICJJTlNFUlQgSU5UTyBtZXNzYWdlX2hpc3RvcnkgKHVzZXJfaWQsIHJvbGUsIGNvbnRlbnQsIGhhc19tZWRpYSkgVkFMVUVTICg/LCA/LCA/LCA/KSIsCiAgICAgICAgICAgICAgICAgICAgKHVzZXJfaWQsIHJvbGUsIGNvbnRlbnQsIGhhc19tZWRpYSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGF3YWl0IGRiLmNvbW1pdCgpCgogICAgYXN5bmMgZGVmIGdldF9jaGF0X2hpc3Rvcnkoc2VsZiwgdXNlcl9pZDogaW50LCBsaW1pdDogaW50ID0gMjApOgogICAgICAgIGlmIHNlbGYudHlwZSA9PSAicG9zdGdyZXMiOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5wb29sOiBhd2FpdCBzZWxmLmNvbm5lY3QoKQogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYucG9vbC5hY3F1aXJlKCkgYXMgY29ubjoKICAgICAgICAgICAgICAgIHJvd3MgPSBhd2FpdCBjb25uLmZldGNoCiAgICAgICAgICAgICAgICAgICAgIlNFTEVDVCByb2xlLCBjb250ZW50IEZST00gbWVzc2FnZV9oaXN0b3J5IFdIRVJFIHVzZXJfaWQgPSAkMSBPUkRFUiBCWSBpZCBERVNDIExJTUlUICQyIiwKICAgICAgICAgICAgICAgICAgICB1c2VyX2lkLCBsaW1pdAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmV0dXJuIFtkaWN0KHJvdykgZm9yIHJvdyBpbiByZXZlcnNlZChyb3dzKV0KICAgICAgICBlbHNlOgogICAgICAgICAgICBhc3luYyB3aXRoIGFpb3NxbGl0ZS5jb25uZWN0KERCX05BTUUpIGFzIGRiOgogICAgICAgICAgICAgICAgZGIucm93X2ZhY3RvcnkgPSBhaW9zcWxpdGUuUm93CiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIGRiLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgIlNFTEVDVCByb2xlLCBjb250ZW50IEZST00gbWVzc2FnZV9oaXN0b3J5IFdIRVJFIHVzZXJfaWQgPSA/IE9SREVSIEJZIGlkIERFU0MgTElNSVQgPyIsCiAgICAgICAgICAgICAgICAgICAgKHVzZXJfaWQsIGxpbWl0KQogICAgICAgICAgICAgICAgKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICAgICAgcm93cyA9IGF3YWl0IGN1cnNvci5mZXRjaGFsbCgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtkaWN0KHJvdykgZm9yIHJvdyBpbiByZXZlcnNlZChyb3dzKV0KCiAgICBhc3luYyBkZWYgY2xlYXJfaGlzdG9yeShzZWxmLCB1c2VyX2lkOiBpbnQpOgogICAgICAgIGlmIHNlbGYudHlwZSA9PSAicG9zdGdyZXMiOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5wb29sOiBhd2FpdCBzZWxmLmNvbm5lY3QoKQogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYucG9vbC5hY3F1aXJlKCkgYXMgY29ubjoKICAgICAgICAgICAgICAgIGF3YWl0IGNvbm4uZXhlY3V0ZSgiREVMRVRFIEZST00gbWVzc2FnZV9oaXN0b3J5IFdIRVJFIHVzZXJfaWQgPSAkMSIsIHVzZXJfaWQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXN5bmMgd2l0aCBhaW9zcWxpdGUuY29ubmVjdChEQl9OQU1FKSBhcyBkYjoKICAgICAgICAgICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoIkRFTEVURSBGUk9NIG1lc3NhZ2VfaGlzdG9yeSBXSEVSRSB1c2VyX2lkID0gPyIsICh1c2VyX2lkLCkpCiAgICAgICAgICAgICAgICBhd2FpdCBkYi5jb21taXQoKQoKIyBTaW5nbGV0b24gaW5zdGFuY2UKZGJfaW5zdGFuY2UgPSBEYXRhYmFzZSgpCgojIFdyYXBwZXIgZnVuY3Rpb25zIGZvciBjb21wYXRpYmlsaXR5CmFzeW5jIGRlZiBpbml0X2RiKCk6CiAgICBhd2FpdCBkYl9pbnN0YW5jZS5jb25uZWN0KCkKCmFzeW5jIGRlZiBnZXRfdXNlcl9zZXR0aW5ncyh1c2VyX2lkKToKICAgIHJldHVybiBhd2FpdCBkYl9pbnN0YW5jZS5nZXRfdXNlcl9zZXR0aW5ncyh1c2VyX2lkKQoKYXN5bmMgZGVmIHVwZGF0ZV91c2VyX3NldHRpbmcodXNlcl9pZCwgc2V0dGluZywgdmFsdWUpOgogICAgYXdhaXQgZGJfaW5zdGFuY2UudXBkYXRlX3VzZXJfc2V0dGluZyh1c2VyX2lkLCBzZXR0aW5nLCB2YWx1ZSkKCmFzeW5jIGRlZiBzYXZlX21lc3NhZ2UodXNlcl9pZCwgcm9sZSwgY29udGVudCwgaGFzX21lZGlhPUZhbHNlKToKICAgIGF3YWl0IGRiX2luc3RhbmNlLnNhdmVfbWVzc2FnZSh1c2VyX2lkLCByb2xlLCBjb250ZW50LCBoYXNfbWVkaWEpCgphc3luYyBkZWYgZ2V0X2NoYXRfaGlzdG9yeSh1c2VyX2lkLCBsaW1pdD0yMCk6CiAgICByZXR1cm4gYXdhaXQgZGJfaW5zdGFuY2UuZ2V0X2NoYXRfaGlzdG9yeSh1c2VyX2lkLCBsaW1pdCkKCmFzeW5jIGRlZiBjbGVhcl9oaXN0b3J5KHVzZXJfaWQpOgogICAgYXdhaXQgZGJfaW5zdGFuY2UuY2xlYXJfaGlzdG9yeSh1c2VyX2lkKQo=